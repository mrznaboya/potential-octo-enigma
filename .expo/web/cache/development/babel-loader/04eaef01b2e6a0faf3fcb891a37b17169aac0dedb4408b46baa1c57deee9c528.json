{"ast":null,"code":"function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\nimport invariant from 'invariant';\nimport { CameraType, ImageType } from \"./CameraModule.types\";\nimport { CameraTypeToFacingMode, ImageTypeFormat, MinimumConstraints } from \"./constants\";\nexport function getImageSize(videoWidth, videoHeight, scale) {\n  var width = videoWidth * scale;\n  var ratio = videoWidth / width;\n  var height = videoHeight / ratio;\n  return {\n    width,\n    height\n  };\n}\nexport function toDataURL(canvas, imageType, quality) {\n  invariant(Object.values(ImageType).includes(imageType), \"expo-camera: \".concat(imageType, \" is not a valid ImageType. Expected a string from: \").concat(Object.values(ImageType).join(', ')));\n  var format = ImageTypeFormat[imageType];\n  if (imageType === ImageType.jpg) {\n    invariant(quality <= 1 && quality >= 0, \"expo-camera: \".concat(quality, \" is not a valid image quality. Expected a number from 0...1\"));\n    return canvas.toDataURL(format, quality);\n  } else {\n    return canvas.toDataURL(format);\n  }\n}\nexport function hasValidConstraints(preferredCameraType, width, height) {\n  return preferredCameraType !== undefined && width !== undefined && height !== undefined;\n}\nfunction ensureCaptureOptions(config) {\n  var captureOptions = {\n    scale: 1,\n    imageType: ImageType.png,\n    isImageMirror: false\n  };\n  for (var key in config) {\n    if (key in config && config[key] !== undefined && key in captureOptions) {\n      captureOptions[key] = config[key];\n    }\n  }\n  return captureOptions;\n}\nvar DEFAULT_QUALITY = 0.92;\nexport function captureImage(video, pictureOptions) {\n  var config = ensureCaptureOptions(pictureOptions);\n  var {\n    scale,\n    imageType,\n    quality = DEFAULT_QUALITY,\n    isImageMirror\n  } = config;\n  var {\n    videoWidth,\n    videoHeight\n  } = video;\n  var {\n    width,\n    height\n  } = getImageSize(videoWidth, videoHeight, scale);\n  var canvas = document.createElement('canvas');\n  canvas.width = width;\n  canvas.height = height;\n  var context = canvas.getContext('2d');\n  if (!context) throw new Error('Context is not defined');\n  if (isImageMirror) {\n    context.setTransform(-1, 0, 0, 1, canvas.width, 0);\n  }\n  context.drawImage(video, 0, 0, width, height);\n  var base64 = toDataURL(canvas, imageType, quality);\n  return base64;\n}\nfunction getUserMedia(constraints) {\n  if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n    return navigator.mediaDevices.getUserMedia(constraints);\n  } else {\n    var _getUserMedia = navigator['mozGetUserMedia'] || navigator['webkitGetUserMedia'];\n    return new Promise((resolve, reject) => _getUserMedia.call(navigator, constraints, resolve, reject));\n  }\n}\nfunction getSupportedConstraints() {\n  if (navigator.mediaDevices && navigator.mediaDevices.getSupportedConstraints) {\n    return navigator.mediaDevices.getSupportedConstraints();\n  }\n  return {};\n}\nexport function getIdealConstraints(preferredCameraType, width, height) {\n  var preferredConstraints = {\n    audio: false,\n    video: {}\n  };\n  if (hasValidConstraints(preferredCameraType, width, height)) {\n    return MinimumConstraints;\n  }\n  var supports = getSupportedConstraints();\n  if (!supports.facingMode || !supports.width || !supports.height) {\n    return MinimumConstraints;\n  }\n  if (preferredCameraType && Object.values(CameraType).includes(preferredCameraType)) {\n    preferredConstraints.video.facingMode = {\n      ideal: CameraTypeToFacingMode[preferredCameraType]\n    };\n  }\n  preferredConstraints.video.width = width;\n  preferredConstraints.video.height = height;\n  return preferredConstraints;\n}\nexport function getStreamDevice(_x, _x2, _x3) {\n  return _getStreamDevice.apply(this, arguments);\n}\nfunction _getStreamDevice() {\n  _getStreamDevice = _asyncToGenerator(function* (preferredCameraType, preferredWidth, preferredHeight) {\n    var constraints = getIdealConstraints(preferredCameraType, preferredWidth, preferredHeight);\n    var stream = yield getUserMedia(constraints);\n    return stream;\n  });\n  return _getStreamDevice.apply(this, arguments);\n}","map":{"version":3,"names":["invariant","CameraType","ImageType","CameraTypeToFacingMode","ImageTypeFormat","MinimumConstraints","getImageSize","videoWidth","videoHeight","scale","width","ratio","height","toDataURL","canvas","imageType","quality","Object","values","includes","concat","join","format","jpg","hasValidConstraints","preferredCameraType","undefined","ensureCaptureOptions","config","captureOptions","png","isImageMirror","key","DEFAULT_QUALITY","captureImage","video","pictureOptions","document","createElement","context","getContext","Error","setTransform","drawImage","base64","getUserMedia","constraints","navigator","mediaDevices","_getUserMedia","Promise","resolve","reject","call","getSupportedConstraints","getIdealConstraints","preferredConstraints","audio","supports","facingMode","ideal","getStreamDevice","_x","_x2","_x3","_getStreamDevice","apply","arguments","_asyncToGenerator","preferredWidth","preferredHeight","stream"],"sources":["/Users/zuyax/Developer/rn-starter/node_modules/expo-camera/src/CameraModule/CameraUtils.ts"],"sourcesContent":["import invariant from 'invariant';\n\nimport { PictureOptions } from './../Camera.types';\nimport { CameraType, CaptureOptions, ImageSize, ImageType } from './CameraModule.types';\nimport { CameraTypeToFacingMode, ImageTypeFormat, MinimumConstraints } from './constants';\n\ninterface ConstrainLongRange {\n  max?: number;\n  min?: number;\n  exact?: number;\n  ideal?: number;\n}\n\nexport function getImageSize(videoWidth: number, videoHeight: number, scale: number): ImageSize {\n  const width = videoWidth * scale;\n  const ratio = videoWidth / width;\n  const height = videoHeight / ratio;\n\n  return {\n    width,\n    height,\n  };\n}\n\nexport function toDataURL(\n  canvas: HTMLCanvasElement,\n  imageType: ImageType,\n  quality: number\n): string {\n  invariant(\n    Object.values(ImageType).includes(imageType),\n    `expo-camera: ${imageType} is not a valid ImageType. Expected a string from: ${Object.values(\n      ImageType\n    ).join(', ')}`\n  );\n\n  const format = ImageTypeFormat[imageType];\n  if (imageType === ImageType.jpg) {\n    invariant(\n      quality <= 1 && quality >= 0,\n      `expo-camera: ${quality} is not a valid image quality. Expected a number from 0...1`\n    );\n    return canvas.toDataURL(format, quality);\n  } else {\n    return canvas.toDataURL(format);\n  }\n}\n\nexport function hasValidConstraints(\n  preferredCameraType?: CameraType,\n  width?: number | ConstrainLongRange,\n  height?: number | ConstrainLongRange\n): boolean {\n  return preferredCameraType !== undefined && width !== undefined && height !== undefined;\n}\n\nfunction ensureCaptureOptions(config: any): CaptureOptions {\n  const captureOptions = {\n    scale: 1,\n    imageType: ImageType.png,\n    isImageMirror: false,\n  };\n\n  for (const key in config) {\n    if (key in config && config[key] !== undefined && key in captureOptions) {\n      captureOptions[key] = config[key];\n    }\n  }\n  return captureOptions;\n}\n\nconst DEFAULT_QUALITY = 0.92;\n\nexport function captureImage(video: HTMLVideoElement, pictureOptions: PictureOptions): string {\n  const config = ensureCaptureOptions(pictureOptions);\n  const { scale, imageType, quality = DEFAULT_QUALITY, isImageMirror } = config;\n\n  const { videoWidth, videoHeight } = video;\n  const { width, height } = getImageSize(videoWidth, videoHeight, scale);\n\n  // Build the canvas size and draw the camera image to the context from video\n  const canvas = document.createElement('canvas');\n  canvas.width = width;\n  canvas.height = height;\n  const context = canvas.getContext('2d');\n\n  //TODO: Bacon: useless\n  if (!context) throw new Error('Context is not defined');\n  // Flip horizontally (as css transform: rotateY(180deg))\n  if (isImageMirror) {\n    context.setTransform(-1, 0, 0, 1, canvas.width, 0);\n  }\n\n  context.drawImage(video, 0, 0, width, height);\n\n  const base64 = toDataURL(canvas, imageType, quality);\n  return base64;\n}\n\nfunction getUserMedia(constraints: MediaStreamConstraints): Promise<MediaStream> {\n  if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n    return navigator.mediaDevices.getUserMedia(constraints);\n  } else {\n    let _getUserMedia = navigator['mozGetUserMedia'] || navigator['webkitGetUserMedia'];\n    return new Promise((resolve, reject) =>\n      _getUserMedia.call(navigator, constraints, resolve, reject)\n    );\n  }\n}\n\nfunction getSupportedConstraints() {\n  if (navigator.mediaDevices && navigator.mediaDevices.getSupportedConstraints) {\n    return navigator.mediaDevices.getSupportedConstraints();\n  }\n  return {};\n}\n\nexport function getIdealConstraints(\n  preferredCameraType: CameraType,\n  width?: number | ConstrainLongRange,\n  height?: number | ConstrainLongRange\n): MediaStreamConstraints {\n  let preferredConstraints: MediaStreamConstraints = {\n    audio: false,\n    video: {},\n  };\n\n  if (hasValidConstraints(preferredCameraType, width, height)) {\n    return MinimumConstraints;\n  }\n\n  const supports = getSupportedConstraints();\n  if (!supports.facingMode || !supports.width || !supports.height) {\n    return MinimumConstraints;\n  }\n\n  if (preferredCameraType && Object.values(CameraType).includes(preferredCameraType)) {\n    (preferredConstraints.video as MediaTrackConstraints).facingMode = {\n      ideal: CameraTypeToFacingMode[preferredCameraType],\n      // exact: CameraTypeToFacingMode[preferredCameraType],\n    };\n  }\n\n  (preferredConstraints.video as MediaTrackConstraints).width = width;\n  (preferredConstraints.video as MediaTrackConstraints).height = height;\n\n  return preferredConstraints;\n}\n\nexport async function getStreamDevice(\n  preferredCameraType: CameraType,\n  preferredWidth?: number | ConstrainLongRange,\n  preferredHeight?: number | ConstrainLongRange\n): Promise<MediaStream> {\n  const constraints: MediaStreamConstraints = getIdealConstraints(\n    preferredCameraType,\n    preferredWidth,\n    preferredHeight\n  );\n  const stream: MediaStream = await getUserMedia(constraints);\n  return stream;\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}